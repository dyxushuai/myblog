笔者曾经有幸参与华为openstack DJ项目中备份模块的开发，随着对openstack cinder源码的拆解，慢慢延伸到整个项目，越发觉得有意思，整个openstack项目几千人参与开发，几十家公司参与贡献，每个版本有条不紊的发布，为什么大而不乱了？我认为项目之初的架构设计高屋建瓴，各个组件架构框架基本相同，局部有差异，松耦合的设计让组件间的职责清晰，组件间的调度简洁明了。新项目上马后二话不说，先把旧的一套代码框架复制过来再说。

我曾吹过openstack的架构设计是教科书式的模板，所以我想借此机会写点东西介绍介绍，一方面温习模式设计，一方面希望能提炼出一些帮助openstack源码阅读，以及今后优化架构设计的经验。

作为程序员，我觉得工作一两年后，你依然想坚持在编程之路上走得更远，那么你就绕不开设计模式（GOF）。在阅读设计模式时，对代码有洁癖的你偶尔会发现自己从前优化代码的手段和一些设计模式很相似，而且读到最后，你会发现你曾经居然用上了两三种设计模式的混合，是不是感觉很牛逼~~

我不想局限于GOF的设计模式，因为随着软件开发越来越趋向于大型软件开发，架构设计、模式设计越来越复杂，包括那一系列的大部头《面向模式的软件架构》，架构设计一直在进化。我想，阿里的去IOE设计引发的大型互联网架构设计应该也能归类成一种模式，也许叫分布式xxx的模式设计。。。。。。

软件开发是一项系统工程，有一定的弹性和取舍，比如前期在摸索MVP(Minimum Viable Product,最小化可行产品)时，你就不敢把架构设计得太重，并发、高可用、系统安全性通通靠边，你唯一考虑的是如何快速的开发原型，看看产品方向是不是对的，所以三层架构（视图、领域层、数据持久层）能应付的情况下，用速错的方式来降低团队的投入。

OK，等你的用户慢慢增长，需求越来越多的时候又要回过头来思考一个问题，我先前的架构设计是否能很轻松的让开发扩展模块，我的领域模型的边界是否足够清晰，未来我需要支持高并发的时候，我的进程是否是无状态的，是不是简单的多起几个进程，多加几台服务器就能解决问题，我的设计是否支持各种形式的平滑升级，执行coding程序员为了方便破坏了你的设计，怎么弥补，他们是对的还是你是对的？。。。。。。

当你的机器投入足够多时，你发现做一些优化的情况下可以节省很多服务器的钱，微服务是不是好的选择，容器了？我要不要把python换成go？我的那层ORM怎么处理？我用数据库来处理一些状态或者不稳定的进程来维护状态，此时要不要换成消息中间件，等等

程序员很喜欢用填坑来自嘲，接手的代码难以维护等等，我们现在离瀑布越来越远了，大家追求的是天下武功为快不破，敏捷大行其道，所以受限于项目之初架构的知识、或者权衡取舍、或者反正一两年后代码不是我维护的心态，很多事情不尽如人意，如果自己追求的是“内圣”，那么向心而求，保留一点洁癖可能会好些。

好的架构设计是有共性的，有时候会让你拍案叫绝，在这样的熏陶下，你也会慢慢的形成一种系统性思维，对于今后解决问题很有帮助。比如，当你去排查问题的时候，你会去找日志、找堆栈，好的设计会有很好的日志处理、排错处理，再比如，一个http请求出问题时，你会尝试着用通过HTTP协议分析各类值和参数，nginx状态及日志，各类配置文件的状态等等，因为好的设计会遵循通用协议

后续争取尽快能把这个系列写完

是否能坚持写代码到50岁？祝愿我能找到这么一个项目
